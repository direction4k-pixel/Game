<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f0f2f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .tabs { display: flex; margin-bottom: 20px; border-bottom: 2px solid #ddd; }
        .tab { padding: 10px 20px; cursor: pointer; border: 1px solid #ddd; margin-left: -1px; background: #f8f9fa; }
        .tab.active { background: #007bff; color: white; border-color: #007bff; }
        .tab-content { display: none; padding: 20px 0; }
        .tab-content.active { display: block; }
        input, button { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ddd; border-radius: 5px; }
        button { background: #007bff; color: white; border: none; cursor: pointer; }
        button:hover { background: #0056b3; }
        .message { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .loading { background: #fff3cd; color: #856404; text-align: center; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h1>
        
        <div class="tabs">
            <div class="tab active" onclick="openTab('test')">Ø§Ø®ØªØ¨Ø§Ø±</div>
            <div class="tab" onclick="openTab('login')">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</div>
            <div class="tab" onclick="openTab('signup')">ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</div>
            <div class="tab" onclick="openTab('users')">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± -->
        <div id="test" class="tab-content active">
            <h2>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù…</h2>
            <button onclick="testConnection()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„</button>
            <button onclick="createTestData()">Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ø®ØªØ¨Ø§Ø±</button>
            <div id="testResult"></div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
        <div id="login" class="tab-content">
            <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
            <input type="email" id="loginEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" value="ahmed@example.com">
            <input type="password" id="loginPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±" value="123456">
            <button onclick="login()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
            <div id="loginResult"></div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ -->
        <div id="signup" class="tab-content">
            <h2>ØªØ³Ø¬ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯</h2>
            <input type="text" id="firstName" placeholder="Ø§Ù„Ø¥Ø³Ù…">
            <input type="text" id="lastName" placeholder="Ø§Ù„Ù„Ù‚Ø¨">
            <input type="email" id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
            <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
            <button onclick="signUp()">ØªØ³Ø¬ÙŠÙ„</button>
            <div id="signupResult"></div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† -->
        <div id="users" class="tab-content">
            <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h2>
            <button onclick="loadUsers()">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</button>
            <div id="usersResult"></div>
        </div>
    </div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxqOe7C64BpIiaTGKG2aEUDCJJzx7yrJGsYhvepTkwbjUTOfEb1WlUgWiFUJ0CrA5-zAQ/exec';
        
        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
        function openTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.style.display = 'none');
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabName).style.display = 'block';
            event.currentTarget.classList.add('active');
        }

        // Ø¯Ø§Ù„Ø© JSONP Ø¹Ø§Ù…Ø©
        function jsonpRequest(params, resultElementId, successCallback) {
            showMessage(resultElementId, 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...', 'loading');
            
            const callbackName = 'jsonpCallback_' + Date.now();
            
            window[callbackName] = function(data) {
                if (data && data.status) {
                    showMessage(resultElementId, 
                        data.status === 'success' ? 'âœ… ' + data.data : 'âŒ ' + data.data, 
                        data.status
                    );
                    
                    if (data.status === 'success' && successCallback) {
                        successCallback(data);
                    }
                } else {
                    showMessage(resultElementId, 'âŒ Ø§Ø³ØªØ¬Ø§Ø¨Ø© ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹Ø©', 'error');
                }
                
                delete window[callbackName];
            };
            
            // Ø¨Ù†Ø§Ø¡ Ø±Ø§Ø¨Ø· Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª
            let url = SCRIPT_URL + '?callback=' + callbackName;
            Object.keys(params).forEach(key => {
                if (params[key] !== undefined && params[key] !== null) {
                    url += '&' + encodeURIComponent(key) + '=' + encodeURIComponent(params[key]);
                }
            });
            
            const script = document.createElement('script');
            script.src = url;
            document.head.appendChild(script);
            
            // ØªÙ†Ø¸ÙŠÙ Ø¨Ø¹Ø¯ 10 Ø«ÙˆØ§Ù†ÙŠ
            setTimeout(() => {
                if (window[callbackName]) {
                    showMessage(resultElementId, 'âŒ Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±', 'error');
                    delete window[callbackName];
                }
            }, 10000);
        }

        // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„
        function testConnection() {
            jsonpRequest({ action: 'test' }, 'testResult');
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ø®ØªØ¨Ø§Ø±
        function createTestData() {
            jsonpRequest({ action: 'createTestData' }, 'testResult');
        }

        // ØªØ³Ø¬ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯
        function signUp() {
            const userData = {
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                email: document.getElementById('email').value,
                password: document.getElementById('password').value
            };

            if (!userData.firstName || !userData.lastName || !userData.email || !userData.password) {
                showMessage('signupResult', 'âŒ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
                return;
            }

            jsonpRequest({
                action: 'signup',
                firstName: userData.firstName,
                lastName: userData.lastName,
                email: userData.email,
                password: userData.password
            }, 'signupResult', function(response) {
                if (response.status === 'success') {
                    document.getElementById('firstName').value = '';
                    document.getElementById('lastName').value = '';
                    document.getElementById('email').value = '';
                    document.getElementById('password').value = '';
                }
            });
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        function login() {
            const loginData = {
                email: document.getElementById('loginEmail').value,
                password: document.getElementById('loginPassword').value
            };

            if (!loginData.email || !loginData.password) {
                showMessage('loginResult', 'âŒ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ù…Ø·Ù„ÙˆØ¨Ø§Ù†', 'error');
                return;
            }

            jsonpRequest({
                action: 'login',
                email: loginData.email,
                password: loginData.password
            }, 'loginResult', function(response) {
                if (response.status === 'success' && response.data.redirectUrl) {
                    showMessage('loginResult', 'âœ… ' + response.data.message + '<br>ğŸš€ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø³Ø±ÙŠ...', 'success');
                    setTimeout(() => {
                        window.open(response.data.redirectUrl, '_blank');
                    }, 2000);
                }
            });
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        function loadUsers() {
            jsonpRequest({ action: 'getUsers' }, 'usersResult', function(response) {
                if (response.status === 'success') {
                    displayUsers(response.data);
                }
            });
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        function displayUsers(users) {
            const usersResult = document.getElementById('usersResult');
            
            if (!users || users.length === 0) {
                usersResult.innerHTML = '<div class="message info">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>';
                return;
            }

            let html = '<div class="message success">ØªÙ… ØªØ­Ù…ÙŠÙ„ ' + users.length + ' Ù…Ø³ØªØ®Ø¯Ù…</div>';
            html += '<table style="width:100%; border-collapse:collapse; margin-top:10px;">';
            html += '<tr><th>#</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø¨Ø±ÙŠØ¯</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr>';
            
            users.forEach((user, index) => {
                html += '<tr>';
                html += '<td>' + (index + 1) + '</td>';
                html += '<td>' + (user.firstName || '') + ' ' + (user.lastName || '') + '</td>';
                html += '<td>' + (user.email || '') + '</td>';
                html += '<td>' + (user.status || '') + '</td>';
                html += '<td>';
                html += '<button onclick="updateStatus(' + user.row + ', \'Ù…Ù‚Ø¨ÙˆÙ„\')">Ù…ÙˆØ§ÙÙ‚Ø©</button>';
                html += '<button onclick="updateStatus(' + user.row + ', \'Ù…Ø±ÙÙˆØ¶\')">Ø±ÙØ¶</button>';
                html += '</td>';
                html += '</tr>';
            });
            
            html += '</table>';
            usersResult.innerHTML = html;
        }

        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        function updateStatus(row, status) {
            const notes = prompt('Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:');
            
            jsonpRequest({
                action: 'updateStatus',
                row: row,
                status: status,
                notes: notes || ''
            }, '', function() {
                loadUsers(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ«
            });
        }

        // ÙˆØ¸ÙŠÙØ© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
        function showMessage(elementId, message, type) {
            const element = document.getElementById(elementId);
            if (element) {
                element.innerHTML = '<div class="message ' + type + '">' + message + '</div>';
            }
        }

        // Ø§Ø®ØªØ¨Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        window.onload = function() {
            testConnection();
        };
    </script>
</body>
</html>
